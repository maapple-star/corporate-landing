---
import HeroSlide from "./hero-slide.astro";
import { slides } from "./data";
---

<!-- HERO -->
<section class="mt-[72px] relative h-[calc(100vh-72px)] overflow-hidden bg-dark" id="home">
  <div class="relative h-full" id="hSlides">
    {slides.map((slide) => <HeroSlide {...slide} />)}
  </div>
  <div class="absolute bottom-0 left-0 right-0 z-3 h-[3px] bg-white/10">
    <div id="sFill" class="h-full bg-blue2 w-0 animate-[progress_5s_linear_infinite]"></div>
  </div>
  <div class="absolute bottom-10 left-[6%] z-3 flex items-center" id="hCtrls">
    {slides.map((_, i) => <div class:list={["h-ctrl", { active: i === 0 }]} data-i={i} />)}
  </div>
  <div class="absolute right-[6%] bottom-10 z-3 flex items-baseline gap-1">
    <span id="hNum" class="font-syne text-[3rem] font-extrabold text-white/15">01</span>
    <span class="text-[0.8rem] text-white/30">/ 03</span>
  </div>
</section>

<script>
  function initHero() {
    const slideEls = document.querySelectorAll<HTMLElement>(".h-slide");
    const controls = document.querySelectorAll(".h-ctrl")!;
    const numEl = document.getElementById("hNum")!;
    const fill = document.getElementById("sFill")!;
    let cur = 0;
    const total = controls.length;
    const intervalInSeconds = 6;

    function go(n: number) {
      cur = (n + total) % total;
      slideEls.forEach((s, i) => s.classList.toggle("active", i === cur));
      controls.forEach((c, i) => c.classList.toggle("active", i === cur));
      numEl.textContent = String(cur + 1).padStart(2, "0");
      fill.style.animation = "none";
      fill.offsetHeight;
      fill.style.animation = `progress ${intervalInSeconds}s linear infinite`;
    }

    controls.forEach((c) => c.addEventListener("click", () => go(+c.getAttribute("data-i")!)));
    go(0);
    setInterval(() => go(cur + 1), intervalInSeconds * 1000);
  }

  document.addEventListener("DOMContentLoaded", initHero);
</script>
